server {
    listen 80;
    server_name localhost;

    # =========================================================
    # 1. ASSETS DEL BACKEND (CSS / JS) - ¡SOLUCIÓN ROBUSTA!
    # =========================================================
    # Esta regla usa Regex (~) para atrapar cualquier archivo .css o .js
    # que tenga estos nombres específicos, sin importar si llevan ?v=...
    location ~ ^/(css|js)/(style|dashboard|script|explorer)\.(css|js)$ {
        proxy_pass http://backend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # =========================================================
    # 2. RUTAS DE LARAVEL (Controladores y Vistas)
    # =========================================================
    # Rutas principales de la aplicación
    location ~ ^/(login|register|dashboard|logout|password|email|sanctum|api|explorar|favoritos|planes|profile|verify-email|confirm-password) {
        proxy_pass http://backend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # =========================================================
    # 3. TODO LO DEMÁS -> FRONTEND (Landing Page)
    # =========================================================
    # Si no coincidió con los CSS de arriba, se asume que es del frontend
    location /css/ {
        proxy_pass http://frontend:80;
    }
    location /js/ {
        proxy_pass http://frontend:80;
    }
    location /img/ {
        proxy_pass http://frontend:80;
    }

    # Raíz
    location = / {
        proxy_pass http://frontend:80;
    }

    # =========================================================
    # 4. CATCH-ALL (Salvavidas para el Backend)
    # =========================================================
    # Cualquier otra cosa rara va a Laravel por defecto
    location / {
        proxy_pass http://backend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}