server {
    listen 80;
    server_name localhost;

    # =========================================================
    # 1. ASSETS DEL BACKEND (CSS / JS)
    # =========================================================
    # IMPORTANTE: Aquí le decimos a Nginx qué archivos CSS/JS están en Laravel.
    # He asegurado que 'layout' y 'dashboard' estén en la lista.
    location ~ ^/(css|js)/(style|dashboard|layout|script|explorer|app|bootstrap|tailwind|custom|flatpickr|profile)\.(css|js)$ {
        proxy_pass http://backend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # Evitar caché mientras desarrollamos para ver cambios al instante
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # =========================================================
    # 2. ASSETS DE VITE (Si aplica)
    # =========================================================
    location /build/ {
        proxy_pass http://backend:80;
        proxy_set_header Host $host;
    }

    # =========================================================
    # 3. RUTAS DE LARAVEL (Controladores)
    # =========================================================
    location ~ ^/(login|register|dashboard|logout|password|email|sanctum|api|explorar|favoritos|planes|profile|verify-email|confirm-password) {
        proxy_pass http://backend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # =========================================================
    # 4. FRONTEND (Imágenes y Landing Page)
    # =========================================================
    # Si no es un CSS del backend (lista de arriba), se pide al Frontend
    location /css/ {
        proxy_pass http://frontend:80;
    }
    location /js/ {
        proxy_pass http://frontend:80;
    }
    # CUIDADO: Si usas imágenes en Laravel (public/img), esto podría dar problemas.
    # Por ahora asumo que las imágenes están en la Landing Page (Frontend).
    location /img/ {
        proxy_pass http://frontend:80;
    }

    # La Raíz exacta va al Frontend
    location = / {
        proxy_pass http://frontend:80;
    }

    # =========================================================
    # 5. CATCH-ALL (Todo lo demás -> Backend)
    # =========================================================
    location / {
        proxy_pass http://backend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}